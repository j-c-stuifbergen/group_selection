<html><!DOCTYPE html>
<html>
<body>

<h2>JavaScript Arrays</h2>

<p id="pict_out">
<svg id="3Dscreen" width="400" height="400" viewbox="-200 -200 400 400" onmousedown='alert("mouse down in svg! good!")'>
  <circle id="bigSun" cx="-0" cy="-100" r="200" stroke="green" stroke-width="4" fill="yellow" />
  <circle id="center" cx="-0" cy="00" r="4" stroke="#999" stroke-width="4" fill="green" />
</svg>
</p>
<p id="message">Hier kan een foutmelding komen </p><hr>
<p id="text_out"></p>

<script>

let displayText = ""

nPlaces = 60;
//nIndividuals = 40;
n40 = 1;
n50 = 1;

// create possible combinations
var v = [];
groupSizes =[1,40,50]
nGroups = [60,1,1]
nCandidates = 0
for (i= 0; i<groupSizes.length; i++)
{	nCandidates += groupSizes[i]*nGroups[i]
}
	displayText += "average probability must be = "+nPlaces +" / "+nCandidates+" = "+nPlaces/nCandidates+"<br>";
	
v.push([nPlaces,0,0]); // only individuals
v.push([nPlaces - 40,1,0]); //  individuals + 1 group of 40
v.push([nPlaces - 50,0,1]); //  individuals + 1 group of 50
var p=[];
// initialise probabilities 
for (let i = 0; i< v.length ; i++)
{	p[i]=1/v.length;
}
var q = []; // used to adapt p, store deviations from desired probabilities
var e = [];// expected number of groups that will have a place
var a = []; // a[j]=e[j]/nGroups[j]; probability that a member of this group will have a place
var b = []; // re-scaled probability that a member of this group will have a place
var c = []; // 
var w = []; // the weight: probability of entering, times number of persons that have this probability
nIterations = 50;
nRemove = Math.ceil(nIterations*0.7)
for (let k = 0; k<= nIterations ; k++)
{
	displayText += "iteration = "+k +"<br>";
	displayText += "p = "+p +"<br>";
	// displayText += "p0/p1 = "+p[0]/p[1] +"<br>";

	var eTotal = 0
	for (let j = 0; j<v[0].length; j++)
	{
		e[j] = 0;
		for (let i = 0; i< v.length ; i++)
		{	e[j] += p[i]*v[i][j];
		}
		eTotal += e[j]*groupSizes[j]
		a[j]=e[j]/nGroups[j];
		b[j]=a[j]/a[0]; // for easier comparison
		c[j] = groupSizes[j]/a[j];
		w[j] = nGroups[j]*groupSizes[j]/a[j];
	}
	displayText += "a = "+a +"<hr>";
	displayText += "eTotal = "+eTotal +"<hr>";
	
	/*
	displayText += "e = "+e +"<hr>";
	displayText += "b = "+b +"<hr>";
	displayText += "c = "+c +"<hr>";
	displayText += "w = "+w +"<hr>";
	*/	
	pTotal = 0;
	qTotal = 0
	for (let i = 0; i< v.length ; i++)
	{	q[i]=0;
		for (let j = 0; j<v[0].length; j++)
		{
			// p[i]+=Math.pow(v[i][j],2)/a[j];//*w[j];// groupSizes[j]/a[j];
		  q[i]+=(nPlaces/nCandidates - a[j])*v[i][j]*groupSizes[j];
	//	  q[i]+=(nPlaces/nCandidates - a[j])*v[i][j];
	//	  q[i]+=(nPlaces - a[j]*nGroups[j]*groupSizes[j])/nCandidates*v[i][j];
	//		displayText += "i,j = "+i+","+j+" p[i] = "+p[i] +"<hr>";
	//	  displayText += "i,j = "+i+","+j+" q[i] = "+q[i] +"<hr>";
		}
		qTotal+=q[i]
	}
	for (let i = 0; i< v.length ; i++)
	{	p[i]+=(q[i]-qTotal/v.length)*0.01
		
		let removeThreshold = 0.00001
		// correct for overshoot
		if (p[i]<0)
		{	p[i]=removeThreshold
		}
		// remove neglectable probabilities
		if (p[i]<removeThreshold)
		{	p[i] = removeThreshold
			if(k<nRemove)
			{	p[i]=0
			}
		}
	}

}
var pTotal =0;
for (let i = 0; i< v.length ; i++)
{	pTotal+=p[i];
}	
for (let i = 0; i< v.length ; i++)
{	p[i]=p[i]/pTotal;
}
	displayText += "iteration = "+nIterations +"<br>";
	displayText += "p = "+p +"<br>ready<br>";

document.getElementById("text_out").innerHTML = displayText;




</script>

</body>
</html>

</script>
